
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.7, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="img/favicon.png">
  <!-- <title>username1 | Xtrade</title> -->
  <link rel="stylesheet" href="../../css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!--<link href="//db.onlinewebfonts.com/c/061b39e95e1a0bd25e8d294af8596b2a?family=Font+Awesome+5+Free" rel="stylesheet" type="text/css"/> -->
  <link rel="stylesheet" href="../../css/font-awesome.min.css" type="text/css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="../../css/bootstrap.css" type="text/css">
  <link href="../../css/dataTables.bootstrap4.css" rel="stylesheet">
  <link href="../../css/responsive.dataTables.min.css" rel="stylesheet">
  <!-- <link href="vendor/jquery-jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet"> -->

  <link rel="stylesheet" href="../../css/dark_blue_adminux.css" type="text/css">
  <link rel="stylesheet" href="../../css/margin.css" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <!-- g-hide -->
  <style type="text/css">
    iframe.goog-te-banner-frame {
      display: none !important;
    }
  </style>
  <style type="text/css">
    iframe.skiptranslate {
      display: none !important;
    }
  </style>
  <style type="text/css">
    body {
      position: static !important;
      top: 0px !important;
    }
  </style>
  <!-- end-g-hide -->
<style>
  button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
    background-color: #6c757d !important; /* Grey color */
    border-color: #6c757d !important;
}
</style>
</head>


<style>
  .ncard {
    box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
    margin: 0.5px;
    padding: 15px
  }
  input[type=number],input[type=text],input[type=email],input[type=file],textarea{
    border: 1px solid grey;
  }
  select{
    border: 2px solid grey;
  }
  a{
    text-decoration: none;
  }

  .blink_me {
  animation: blinker 1s linear infinite;
}

@keyframes blinker {
  50% {
    opacity: 0;
  }
}

</style>

<!-- g-hide -->
<!-- <body class="menuclose menuclose-right"> -->
<body class="menuclose menuclose-right" style="">
<!-- <body class="menuclose menuclose-right  " style="background:linear-gradient(to right, #ffba00 0%, #fc9244 30%, #252d47 100%)"> -->
<!-- <body class="menuclose menuclose-right rounded " style="background:linear-gradient(to right, #ffba00 0%, black 50%, #ffba00 100%)"> -->

  <!-- Page Loader -->
  <!-- <div class="loader_wrapper align-items-center text-center">
    <div class="load7 load-wrapper">
      <img src="img/logo.png" alt="" class="loading_img">
      <div class="loader"> Loading... </div>
      <div class="clearfix"></div>
      <br>
      <br>
      <br>
      <br>
      <h4 class="text-white">Petal of Flower</h4>
      <p>Awesome things are getting ready...</p>
    </div>
  </div> -->
  <!-- Page Loader Ends -->


  <header class="navbar-fixed">
    <nav class="navbar navbar-toggleable-md navbar-inverse bg-faded">
      <div class="sidebar-left"> <a class="navbar-brand imglogo" href="home"></a>
        <button class="btn btn-link icon-header mr-sm-2 pull-right menu-collapse"><span class="fa fa-bars"></span></button>
      </div>
      <!-- <form class="form-inline mr-sm-2  pull-left search-header hidden-md-down">
        <input class="form-control " type="text" placeholder="Search" id="search_header">
        <button class="btn btn-link icon-header " type="submit"><span class="fa fa-search"></span></button>
      </form> -->
      <div class="d-flex mr-auto"> &nbsp;</div>
      <ul class="navbar-nav content-right">
        <li class="align-self-center">
          <!-- hidden-md-down -->
          <span>Language:</span>
          <select class="custom-select lang-sel" style="width:110px;border: 0px solid #0080db00;" id="language" onchange="changeLanguageByButtonClick()">
            <option value="en" selected>English</option>
            <option value="af">Afrikanns</option>
            <option value="sq">Albanian</option>
            <option value="ar">Arabic</option>
            <option value="hy">Armenian</option>
            <option value="eu">Basque</option>
            <option value="bn">Bengali</option>
            <option value="bg">Bulgarian</option>
            <option value="ca">Catalan</option>
            <option value="km">Cambodian</option>
            <option value="zh-CN">Chinese (Mandarin)</option>
            <option value="hr">Croation</option>
            <option value="cs">Czech</option>
            <option value="da">Danish</option>
            <option value="nl">Dutch</option>
            <option value="et">Estonian</option>
            <option value="fj">Fiji</option>
            <option value="fi">Finnish</option>
            <option value="fr">French</option>
            <option value="ka">Georgian</option>
            <option value="de">German</option>
            <option value="el">Greek</option>
            <option value="gu">Gujarati</option>
            <option value="he">Hebrew</option>
            <option value="hi">Hindi</option>
            <option value="hu">Hungarian</option>
            <option value="is">Icelandic</option>
            <option value="id">Indonesian</option>
            <option value="ga">Irish</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="jw">Javanese</option>
            <option value="ko">Korean</option>
            <option value="la">Latin</option>
            <option value="lv">Latvian</option>
            <option value="lt">Lithuanian</option>
            <option value="mk">Macedonian</option>
            <option value="ms">Malay</option>
            <option value="ml">Malayalam</option>
            <option value="mt">Maltese</option>
            <option value="mi">Maori</option>
            <option value="mr">Marathi</option>
            <option value="mn">Mongolian</option>
            <option value="ne">Nepali</option>
            <option value="no">Norwegian</option>
            <option value="fa">Persian</option>
            <option value="pl">Polish</option>
            <option value="pt">Portuguese</option>
            <option value="pa">Punjabi</option>
            <option value="qu">Quechua</option>
            <option value="ro">Romanian</option>
            <option value="ru">Russian</option>
            <option value="sm">Samoan</option>
            <option value="sr">Serbian</option>
            <option value="sk">Slovak</option>
            <option value="sl">Slovenian</option>
            <option value="es">Spanish</option>
            <option value="sw">Swahili</option>
            <option value="sv">Swedish </option>
            <option value="ta">Tamil</option>
            <option value="tt">Tatar</option>
            <option value="te">Telugu</option>
            <option value="th">Thai</option>
            <option value="bo">Tibetan</option>
            <option value="to">Tonga</option>
            <option value="tr">Turkish</option>
            <option value="uk">Ukranian</option>
            <option value="ur">Urdu</option>
            <option value="uz">Uzbek</option>
            <option value="vi">Vietnamese</option>
            <option value="cy">Welsh</option>
            <option value="xh">Xhosa</option>
          </select>
        </li>
        <li class="v-devider"></li>
                <li class="v-devider"></li>
        <li class="nav-item "> <a class="btn btn-link icon-header menu-collapse-right" href="#"><span class="fa fa-podcast"></span> </a> </li>
      </ul>
      <div class="sidebar-right pull-right ">
        <ul class="navbar-nav  justify-content-end">
          <li class="nav-item">
            <button class="btn-link btn userprofile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="userpic"><img src="img/profile/default.png" alt="user pic"></span> <span class="text">username1</span></button>
            <div class="dropdown-menu"> 
              <a class="dropdown-item" href="settings"><i class="fas fa-user"></i> Profile</a> 
              <a class="dropdown-item" href="deposit"><i class="fas fa-coins"></i> Deposit</a>
              <a class="dropdown-item" href="withdraw"><i class="fas fa-wallet"></i> Withdraw</a>
              <a class="dropdown-item" href="transactions"><i class="fas fa-exchange-alt"></i> Transactions</a>
              <a class="dropdown-item" href="logout"><i class="fa fa-sign-out"></i> Logout</a>
            </div>
          </li>
          <style>
            /* Ensure the menu is hidden by default */
.dropdown-menu {
    display: none;
    position: absolute;
    /* add your positioning styles here */
}

/* JavaScript toggles this class */
.dropdown-menu.show {
    display: block;
}
          </style>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
    const profileBtn = document.querySelector('.userprofile');
    const dropdownMenu = document.querySelector('.dropdown-menu');

    // Toggle dropdown on click
    profileBtn.addEventListener('click', function(e) {
        e.stopPropagation(); // Prevents the click from immediately reaching the 'window' listener
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        // Toggle state
        this.setAttribute('aria-expanded', !isExpanded);
        dropdownMenu.classList.toggle('show');
    });

    // Close dropdown when clicking anywhere outside the menu
    window.addEventListener('click', function(e) {
        if (!profileBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.remove('show');
            profileBtn.setAttribute('aria-expanded', 'false');
        }
    });
});
          </script>
          <li><a href="logout" class="btn btn-link icon-header"><span class="fa fa-sign-out"></span></a></li>
        </ul>
      </div>
    </nav>
  </header>
  <div class="sidebar-left">
    <div class="user-menu-items">
      <div class="list-unstyled btn-group">
        <button class="media btn btn-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 
          <br>
        <span class="message_userpic"><img class="d-flex" src="img/profile/default.png" alt="Generic user image"></span> 
          <span class="media-body"> <span class="mt-0 mb-1">username2 username3</span>
            <small>Verified</small> </span> </button>
      </div>
    </div>
    <br>
    <ul class="nav flex-column in" id="side-menu">
      <li class=" nav-item"><a href="account" class="nav-link "><i class="fas fa-tachometer-alt"></i> Account</a>
      </li>
      <li class=" nav-item"><a href="deposit" class="nav-link "><i class="fas fa-coins"></i> Deposit</a>
      </li>
      <li class=" nav-item"><a href="withdraw" class="nav-link "><i class="fas fa-wallet"></i> Withdraw</a>
      </li>
      <li class=" nav-item"><a href="history" class="nav-link "><i class="fas fa-exchange-alt"></i> History</a>
      </li>
      <li class=" nav-item"><a href="transactions" class="nav-link "><i class="fas fa-exchange-alt"></i> Transactions</a>
      </li>
      <!-- <li class=" nav-item"><a href="trading" class="nav-link "><i class="fas fa-chart-bar"></i> Place Trade</a> -->
      </li>
      <li class=" nav-item"><a href="purchase" class="nav-link "><i class="fas fa-chart-pie"></i> Account Upgrade</a>
      </li>
      <li class=" nav-item"><a href="purchase#signal_deposit" class="nav-link "><i class="fa fa-signal"></i> Signal Purchase</a>
      </li>
      <li class=" nav-item"><a href="news" class="nav-link "><i class="fas fa-newspaper"></i>News </a>
      </li>
      <li class=" nav-item"><a href="settings" class="nav-link "><i class="fas fa-cogs"></i>Account Settings </a>
      </li>
      <li class=" nav-item"><a href="logout" class="nav-link "><i class="fa fa-sign-out"></i> Logout</a>
      </li>
      <li class="title-nav">
      <li class="nav-item "> <a href="javascript:void(0)" class="menudropdown nav-link">Live Analysis<i class="fa fa-angle-down "></i></a>
        <ul class="nav flex-column nav-second-level ">
          <li class="nav-item"><a class="nav-link" href="technical"><i class="fas fa-expand-arrows-alt"></i> Technical Analysis</a></li>
          <li class="nav-item"><a class="nav-link" href="chart"><i class="fas fa-chart-area"></i> Live Market Chart</a>
          <li class="nav-item"><a class="nav-link" href="calendar"><i class="fas fa-calendar-alt"></i> Market Calendar</a>
          </li>
        </ul>
        <!-- /.nav-second-level -->
      </li>
      </li>
    </ul>
    <hr>
    <ul class="nav flex-column in">
      <li class="nav-item "><a href="#" class="nav-link"><span><span class="dynamicsparkline2">Loading..</span>
          </span></a></li>
                    
    </ul>
    <hr>
    <br>
    <br>
  </div>
  <div class="wrapper-content">
    <!-- <div class="container" style="max-width:1300px"> -->
    <div class="container" style="max-width:1400px">



  <title>username1 | SETTINGS</title>


<div class="row  align-items-center justify-content-between" style="margin-top:10px">
  <div class="col-16 col-sm-16" class="btn-group pull-right">
    <p style="color:white"><b>ACCOUNT SETTINGS | PROFILE</b></p>
  </div>
</div>



<!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container ">
  <div class="tradingview-widget-container__widget"></div>
  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
    {
      "symbols": [{
          "proName": "FOREXCOM:SPXUSD",
          "title": "S&P 500"
        },
        {
          "proName": "FOREXCOM:NSXUSD",
          "title": "Nasdaq 100"
        },
        {
          "proName": "FX_IDC:EURUSD",
          "title": "EUR/USD"
        },
        {
          "proName": "BITSTAMP:BTCUSD",
          "title": "BTC/USD"
        },
        {
          "proName": "BITSTAMP:ETHUSD",
          "title": "ETH/USD"
        }
      ],
      "showSymbolLogo": true,
      "colorTheme": "dark",
      "isTransparent": false,
      "displayMode": "relative",
      "locale": "en"
    }
  </script>
</div>
<!-- TradingView Widget END -->






<div class="row">
  <div class="col-sm-16 col-16">
    <div class="row  align-items-end  customer-profile-cover">
      <figure class="background"><img src="img/kk7.gif" alt="Social cover image"> </figure>
      <div class="container mb-2">
        <div class="row  align-items-center p-2">
          <figure class="social-profile-pic"><img src="img/profile/default.png" alt=""></figure>
          <div class="col-sm-16 col-lg-4 col-xl-4  profile-name">
            <i style="color:#0f0;font-size:20px" class="fas fa-check-circle blink_me"> Verified</i>            <h2>username2 username3</h2>
            <p>useremail</p>
          </div>
          <div class="col-16 col-sm-16 col-lg-9 col-xl-9 text-right d-flex">
            <div class="col col-sm-5 col-lg-6 col-xl-6 ">
              <h4>Investment</h4>
              <h2 class="user-investment">$0.00</h2>
            </div>
            <div class="col col-sm-6 col-lg-6 col-xl-6 ">
              <h4>Total Balance</h4>
              <h2 class="user-balanca">$0.00</h2>
            </div>
            <div class="col col-sm-5 col-lg-6 col-xl-6 ">
              <h4>Total Bonus</h4>
              <h2 class="user-bonus">$55.00</h2>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- <div class="container"> -->


<div class="row  align-items-center justify-content-between" style="margin-top:10px">
  <div class="col-16 col-sm-16">
    <div class="btn-group pull-right">
      <a href="home"><button class="btn btn-success btn-outline-light"><span class="">Account</span> <span class="text"><i class="fas fa-tachometer-alt ml-2"></i></span></button></a>
      <a href="deposit"><button class="btn btn-success btn-outline-light"><span class="">Make Deposit</span> <span class="text"><i class="fas fa-coins ml-2"></i></span></button></a>
      <a href="withdraw"><button class="btn btn-success btn-outline-light"><span class="">Withdraw Funds</span> <span class="text"><i class="fas fa-wallet ml-2"></i></span></button></a>
      <button class="btn btn-success btn-outline-light" data-toggle="modal" data-target="#mail_support"><span class="">Mail Us</span> <span class="text"><i class="fas fa-envelope-open-text ml-2"></i></span></button>
      <a href="settings"><button class="btn btn-danger btn-outline-danger"><span class="">Settings</span> <i class="fa fa-cog fa-spin ml-2"></i></button></a>
    </div>
  </div>
</div>
<hr>

<ul class="nav nav-tabs" role="tablist" style="float:center">
  <li class="nav-item"> <a class="nav-link btn-outline-light active" data-toggle="tab" href="#profile" role="tab">Personal Profile</a> </li>
  <li class="nav-item"> <a class="nav-link btn-outline-light" data-toggle="tab" href="#funds" role="tab">Account Records</a> </li>
  <li class="nav-item"> <a class="nav-link btn-outline-light" data-toggle="tab" href="#settings" role="tab">Account Settings</a> </li>
  <!-- <li class="nav-item"> <a class="nav-link btn-outline-light" data-toggle="tab" href="#referrals" role="tab">Referrals</a> </li> -->
</ul>
<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="profile" role="tabpanel">
    <div class="row">
      <div class="col-sm-16 col-lg-8 col-md-8">
        <h3 class="mt-2">Personal Profile Info</h3>
        <hr>
      </div>
      <form class="col-sm-16" method="POST" action="">
        <div class="row">
          <div class="col-md-12">
            <div class="form-group row">
              <div class="col-lg-8 col-md-8">
                <label><i class="fas fa-users"></i> First Name</label>
                <input type="text" class="form-control" name="firstName" value="username2" placeholder="" required>
              </div>
              <div class="col-lg-8 col-md-8">
                <label><i class="fas fa-users"></i> Last Name</label>
                <input type="text" class="form-control" name="lastName" value="username3" placeholder="" required>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-8 col-md-8">
                <label><i class="fas fa-user"></i> Username</label>
                <input type="text" style="color:black" class="form-control" value="username1" placeholder="" readonly>
              </div>
              <div class="col-lg-8 col-md-8">
                <label><i class="fas fa-at"></i> Email Address</label>
                <input type="email" style="color:black" class="form-control" value="useremail" placeholder="" readonly>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-8 col-md-8">
                <div class="row">
                  <div class="col-lg-8">
                    <label><i class="fas fa-phone"></i> Phone Number</label>
                    <input type="text" class="form-control" style="color:black" value="usermobile" placeholder="" readonly>
                  </div>
                  <div class="col-lg-8">
                    <label><i class="fas fa-map-marker-alt"></i> Country</label>
                    <input type="text" style="color:black" class="form-control" value="usercountry" placeholder="" readonly>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-8 col-md-8">
                <div class="row">
                  <div class="col-lg-8">
                    <label><i class="fas fa-map-marker-alt"></i> Postal/Zip Code</label>
                    <input type="text" class="form-control" name="zip" value="userzip" placeholder="">
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-lg-8 col-md-8">
                <label><i class="fas fa-map-marker-alt"></i> Address</label>
                <textarea class="form-control" placeholder="Type here" name="address" rows="4" value="january 35 street">useraddress</textarea>
              </div>
              <div class="col-lg-8 col-md-8">
                <div class="notes notes-primary" role="alert">
                  <strong><i class="fas fa-envelope"></i> Notification Message</strong><br>
                  <div id="mesg" style="display:block; margin-top:10px; color: black; font-weight: normal;">
      Loading...
    </div>
                                    <br>
                </div>
              </div>
            </div>
          </div>
<script>
// Variable to track which IDs have been replied to in this session
let repliedIds = [];

async function loadNotification() {
    const sessionRaw = localStorage.getItem("user_email");
    if (!sessionRaw) return;
    let email = getEmailFromSession(sessionRaw);

    const noteBox = document.getElementById("mesg");

    try {
        const response = await fetch(`https://xtrade-ndxz9ex7.b4a.run//api/notifications?email=${email}`);
        const data = await response.json();
        
        if (data.success && data.messages && data.messages.length > 0) {
            noteBox.innerHTML = ""; 
            data.messages.forEach((item) => {
                const msgWrapper = document.createElement("div");
                msgWrapper.style.cssText = "border-bottom:1px solid #ddd; padding:10px 0; color:black;";
                
                // We create the list with specific IDs for each message
                msgWrapper.innerHTML = `
                    <div class="msg-text"><strong>Admin:</strong> ${item.msg}</div>
                    <div class="msg-actions" style="margin-top:5px;">
                        <a href="javascript:void(0)" onclick="handleReplyPopup(${item.id})" style="font-size:12px; color:blue; margin-right:15px; font-weight:bold;">
                            <i class="fas fa-reply"></i> Reply
                        </a>
                        <a href="javascript:void(0)" onclick="deleteMsg(${item.id})" style="font-size:12px; color:red; font-weight:bold;">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                `;
                noteBox.appendChild(msgWrapper);
            });
        } else {
            noteBox.innerHTML = "<span style='color:#888'>No new notifications.</span>";
        }
    } catch (err) {
        noteBox.textContent = "Error loading notifications.";
    }
}

// THE POPUP REPLIER (No #mail_support needed)
async function handleReplyPopup(id) {
    if (repliedIds.includes(id)) {
        Swal.fire({ icon: 'warning', title: 'Already Replied', background: '#232b44', color: '#fff' });
        return;
    }

    const { value: text } = await Swal.fire({
        title: 'Type your reply',
        input: 'textarea',
        inputPlaceholder: 'Type your message here...',
        showCancelButton: true,
        confirmButtonText: 'Send Reply',
        background: '#232b44',
        color: '#fff',
        inputAttributes: { 'aria-label': 'Type your message here' },
        preConfirm: (value) => {
            if (!value) {
                Swal.showValidationMessage('Reply cannot be empty');
            }
            return value;
        }
    });

    if (text) {
        sendReplyToServer(id, text);
    }
}

async function sendReplyToServer(id, text) {
    const sessionRaw = localStorage.getItem('user_email');
    let email = getEmailFromSession(sessionRaw);

    try {
        const res = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/reply-notification', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: email, message: text, replyToId: id })
        });
        
        const result = await res.json();
        if (result.success) {
            repliedIds.push(id); // Block further replies to this specific message
            
            Swal.fire({
                icon: 'success',
                title: 'Sent!',
                text: 'Your reply has been sent to admin.',
                background: '#232b44',
                color: '#fff'
            });
            
            // Optional: Reload to show the conversation (if your server supports history)
            loadNotification(); 
        }
    } catch (err) {
        Swal.fire({ icon: 'error', title: 'Failed', text: 'Error sending reply.' });
    }
}

async function deleteMsg(id) {
    const sessionRaw = localStorage.getItem("user_email");
    let email = getEmailFromSession(sessionRaw);

    const confirm = await Swal.fire({
        title: 'Delete this message?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        background: '#232b44',
        color: '#fff'
    });

    if (confirm.isConfirmed) {
        try {
            const res = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/delete-notification', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, id: id })
            });
            if ((await res.json()).success) {
                loadNotification(); // Refresh the list immediately
                Swal.fire({ title: 'Deleted', icon: 'success', toast: true, position: 'top-end', timer: 2000, showConfirmButton: false });
            }
        } catch (err) {
            Swal.fire('Error', 'Could not delete', 'error');
        }
    }
}

function getEmailFromSession(raw) {
    try {
        const parsed = JSON.parse(raw);
        return parsed.email || parsed;
    } catch(e) { return raw; }
}

document.addEventListener('DOMContentLoaded', loadNotification);
</script>
          <div class="col-md-4">
            <div class="card ">
              <label><i class="fas fa-address-card"></i> Account Status</label><br>
              <!-- <label class="text-primary" for="">Verified</label> -->
              <label class="text-primary" for="">
                <i style="color:#0f0;font-size:20px" class="fas fa-check-circle blink_me"> Verified</i>              </label>
              <label><i class="fas fa-sync-alt"></i> Account Type</label><br>
              <label class="text-primary" for=""><br>userplan</label>
              <label><i class="fas fa-chart-pie"></i> Package Plan</label><br>
              <label class="text-primary" for="">usersignal</label>
              <label><i class="fas fa-signal "></i> Signal Status</label><br>
              <label class="text-primary" for="">None<br></label>
            </div>
          </div>
        </div>
        <div class="mb-2 row">
          <div class="col-lg-16">
            <hr>
            <button type="submit" name="client_update_info" class="btn btn-primary">Update Profile</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="tab-pane " id="funds" role="tabpanel">
    <div class="row ">
      <div class="col-lg-16 col-md-16">
        <div class="form-group ">
          <h3 class="mt-2">Account Records</h3>
          <hr>
          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th>Type</th>
                <th></th>
                <th></th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>Total Investment</th>
                <td></td>
                <td></td>
                <td><label class="user-investment">0.00 </label></td>
              </tr>
              <tr>
                <th>Total Earnings</th>
                <td></td>
                <td></td>
                <td><label id="user-earnings">$0.00 </label></td>
              </tr>
              <tr>
                <th>Total Balance</th>
                <td></td>
                <td></td>
                <td><label class="user-balanca">0.00 </label></td>
              </tr>
              <tr>
                <th>Total Referral</th>
                <td></td>
                <td></td>
                <td><label class="user-trefcount">0</label></td>
              </tr>
              <tr>
                <th>Total Bonus</th>
                <td></td>
                <td></td>
                <td><label class="user-bonus">0.00 </label></td>
              </tr>
              <tr>
                <th>Pending Withdrawal</th>
                <td></td>
                <td></td>
                <td><label class="user-pwithdrawal">$0.00 </label></td>
              </tr>
              <tr>
                <th>Total Withdrawal</th>
                <td></td>
                <td></td>
                <td><label class="user-twithdrawal">$0.00 </label></td>
              </tr>
              <tr>
                <th>Last Deposit</th>
                <td></td>
                <td></td>
                <td><label class="user-ldeposit">$0.00 </label></td>
              </tr>
              <tr>
                <th>Last Withdrawal</th>
                <td></td>
                <td></td>
                <td><label class="user-lwithdrawal">$0.00 </label></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-lg-16">
        <hr>
        <a href="transactions" style="float:left" name="client_update" class="btn btn-primary">View Transactions</a>
        <a href="history" style="float:right" name="client_update" class="btn btn-primary">View Trade History</a>
      </div>
    </div>
  </div>
  <div class="tab-pane " id="settings" role="tabpanel">
    <div class="row">
      <div class="col-sm-8 col-md-8">
        <form method="POST" action="">
          <div class="card">
            <div class="card-header">
              <span>
                <h3 style="color:crimson;text-align:center"></h3>
              </span>
              <span>
                <h3 style="color:green;text-align:center"></h3>
              </span>
              <h3 class="mt-2">CHANGE PASSWORD</h3>
            </div>
            <div class="card-body">
              <div class="form-group row">
                <label for="example-number-input" class="col-16 col-form-label">Old Password</label>
                <div class="col-16">
                  <input class="form-control" type="password" value="" name="password" id="example-number-input" required>
                  <!-- <span style="color:crimson"></span> -->
                </div>
              </div>
              <div class="form-group row">
                <label for="example-number-input" class="col-16 col-form-label">New Password</label>
                <div class="col-16">
                  <input class="form-control" type="password" value="" name="password1" id="example-number-input" required>
                  <!-- <span style="color:crimson"></span> -->
                </div>
              </div>
              <div class="form-group row">
                <label for="example-number-input" class="col-16 col-form-label">Rewrite New Password</label>
                <div class="col-16">
                  <input class="form-control" type="password" value="" name="password2" id="example-number-input" required>
                  <!-- <span style="color:crimson"></span> -->
                </div>
              </div>
              <div class="form-group row">
                <div class="col-16">
                  <center><a href="#"><input class="btn btn-outline-secondary" type="reset" name="request_btn" value="clear"></a>
                    <input class="btn btn-outline-primary" type="submit" name="changePwd_btn" value="Change Password">
                  </center>
                </div>
              </div>
            </div>
          </div>
        </form>
<div class="card mt-3">
  <div class="card-header">
    <h3 class="mt-2">Transaction PIN</h3>
  </div>
  <div class="card-body">
    <p id="pin_status_msg" class="text-white-50 mb-3">You can set a new transaction PIN.</p>
    <div class="d-flex gap-2">
      <button type="button" id="setPinBtn" class="btn btn-outline-primary">Set / Change PIN</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const userEmail = localStorage.getItem('user_email');
    const setPinBtn = document.getElementById('setPinBtn');
    const statusMsg = document.getElementById('pin_status_msg');

    if (!userEmail) {
        statusMsg.textContent = "User session not found. Please log in.";
        return;
    }

    // Load current PIN status
    (async () => {
        try {
            const res = await fetch(`https://xtrade-ndxz9ex7.b4a.run//account/pin-status?email=${userEmail}`);
            const result = await res.json();
            if (result.success) {
                statusMsg.textContent = result.hasPin ? "PIN is active" : "No PIN set yet";
            } else {
                statusMsg.textContent = "PIN status unavailable";
            }
        } catch (err) {
            statusMsg.textContent = "Failed to load PIN status";
        }
    })();

    setPinBtn.addEventListener('click', async () => {

        // Step 1: Verify account password
        const { value: password } = await Swal.fire({
            title: 'Verify Account Password',
            input: 'password',
            inputPlaceholder: 'Enter your account password',
            showCancelButton: true,
            confirmButtonText: 'Verify',
            allowOutsideClick: false,
            preConfirm: pass => {
                if (!pass) Swal.showValidationMessage('Password cannot be empty');
                return pass;
            },
            didOpen: () => {
                // prevent Enter from submitting and reloading
                const input = Swal.getInput();
                input.addEventListener('keydown', e => { if (e.key === 'Enter') e.preventDefault(); });
            }
        });
        if (!password) return;

        // Step 2: Verify password with server
        try {
            const verifyRes = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/verify-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: userEmail, password })
            });
            const verifyResult = await verifyRes.json();
            if (!verifyResult.success) return Swal.fire('Error', verifyResult.message || 'Incorrect password', 'error');
        } catch (err) {
            return Swal.fire('Error', 'Server error during password verification.', 'error');
        }

        // Step 3: Enter new PIN
        const { value: newPin } = await Swal.fire({
            title: 'Enter new 4-digit PIN',
            input: 'password',
            inputAttributes: { maxlength: 4, inputmode: 'numeric' },
            inputPlaceholder: '1234',
            showCancelButton: true,
            confirmButtonText: 'Next',
            allowOutsideClick: false,
            preConfirm: pin => {
                if (!/^\d{4}$/.test(pin)) Swal.showValidationMessage('PIN must be exactly 4 digits');
                return pin;
            },
            didOpen: () => {
                const input = Swal.getInput();
                input.addEventListener('keydown', e => { if (e.key === 'Enter') e.preventDefault(); });
            }
        });
        if (!newPin) return;

        // Step 4: Confirm PIN
        const { value: confirmPin } = await Swal.fire({
            title: 'Confirm new PIN',
            input: 'password',
            inputAttributes: { maxlength: 4, inputmode: 'numeric' },
            inputPlaceholder: '1234',
            showCancelButton: true,
            confirmButtonText: 'Save PIN',
            allowOutsideClick: false,
            preConfirm: pin => {
                if (!/^\d{4}$/.test(pin)) Swal.showValidationMessage('PIN must be exactly 4 digits');
                return pin;
            },
            didOpen: () => {
                const input = Swal.getInput();
                input.addEventListener('keydown', e => { if (e.key === 'Enter') e.preventDefault(); });
            }
        });
        if (!confirmPin) return;

        if (newPin !== confirmPin) {
            return Swal.fire('Error', 'PINs do not match!', 'error');
        }

        // Step 5: Save PIN
        Swal.fire({ title: 'Saving PIN...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
        try {
            const saveRes = await fetch('https://xtrade-ndxz9ex7.b4a.run//account/update-pin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: userEmail, pin: newPin, password })
            });
            const saveResult = await saveRes.json();
            if (saveResult.success) {
                Swal.fire('Success', 'Your transaction PIN has been set.', 'success');
                statusMsg.textContent = "PIN is set and active.";
            } else {
                Swal.fire('Error', saveResult.message || 'Failed to update PIN', 'error');
            }
        } catch (err) {
            Swal.fire('Error', 'Server error while saving PIN.', 'error');
        }
    });
});
</script>

        <hr>
        <hr>
      </div>
      <div class="col-sm-8 col-md-8">
<form id="profileImageForm" enctype="multipart/form-data" action="javascript:void(0);">
    <div class="card">
        <div class="card-header">
            <h3 class="mt-2">CHANGE PROFILE IMAGE</h3>
        </div>

        <div class="card-body">
            <div class="form-group row">
                <div class="col-16 text-center">

                    <!-- Profile Preview -->
                    <img
                        id="profile-preview"
                        src="img/profile/default.png"
                        class="form-control mb-3"
                        style="width:220px;height:220px;object-fit:cover;"
                        alt="Profile Image"
                    >

                    <!-- File Input -->
                    <input
                        class="form-control"
                        type="file"
                        name="profile"
                        accept="image/*"
                        id="profileInput"
                    >
                </div>
            </div>

            <div class="form-group row">
                <div class="col-16 text-center">
                    <!-- Action Button -->
                    <button
                        type="button"
                        id="changeImg_btn"
                        class="btn btn-outline-primary"
                    >
                        Change Profile Image
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

        <hr>
        <hr>
      </div>
      </form>
    </div>
  </div>
<br><br>
<script>
  // --- PASSWORD CHANGE LOGIC ---
// Add this to your dashboard scripts
document.querySelector('input[name="changePwd_btn"]').addEventListener('click', async (e) => {
    e.preventDefault();
    
    // 1. Get the email from localStorage
    const userEmail = localStorage.getItem('user_email');
    
    if (!userEmail) {
        return Swal.fire("Error", "User session not found. Please log in again.", "error");
    }

    const form = e.target.closest('form');
    const oldPass = form.password.value;
    const newPass = form.password1.value;
    const confirmPass = form.password2.value;

    // Validation
    if (!oldPass || !newPass) {
        return Swal.fire("Required", "Please fill in all password fields.", "warning");
    }
    if (newPass !== confirmPass) {
        return Swal.fire("Error", "New passwords do not match!", "error");
    }

    Swal.fire({
        title: 'Updating Password...',
        allowOutsideClick: false,
        didOpen: () => { Swal.showLoading(); }
    });

    try {
        const response = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/change-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                email: userEmail, 
                oldPassword: oldPass, 
                newPassword: newPass 
            })
        });

        const result = await response.json();

        if (result.success) {
            Swal.fire("Success", "Your password has been updated.", "success");
            form.reset();
        } else {
            Swal.fire("Failed", result.message, "error");
        }
    } catch (err) {
        Swal.fire("Error", "Could not connect to the server.", "error");
    }
});

</script>
<div class="row">
  <div class="col-md-12">
    <div class="form-group row">
      <div class="col-10">
        <input type="text" style="color:black" class="form-control" id="referral_link" value="https://www.Xtrade.live/account/register?username1" readonly="">
      </div>
      <div class="col-6">
        <button type="button" onclick="referralFunction()" class="btn btn-primary">Copy Referral Link</button>
      </div>
    </div>
  </div>
</div>
</div>



<br><br>
<style>
/* Hide panes by default */
.tab-pane {
    display: none;
}

/* Show active pane with animation */
.tab-pane.active {
    display: block !important;
    animation: slideUp 0.4s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(15px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Styling for the nav links to match Xtrade theme */
.nav-link.active {
    background-color: #253978 !important;
    color: white !important;
    border-bottom: 2px solid #007bff;
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabLinks = document.querySelectorAll('.nav-link[data-toggle="tab"]');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // 1. Remove active status from all links
            tabLinks.forEach(l => l.classList.remove('active'));
            // 2. Hide all tab panes
            tabPanes.forEach(pane => {
                pane.classList.remove('active', 'show');
                pane.style.display = 'none'; // Explicitly hide
            });

            // 3. Set current link as active
            this.classList.add('active');

            // 4. Show the target pane
            const targetId = this.getAttribute('href');
            const targetPane = document.querySelector(targetId);
            
            if (targetPane) {
                targetPane.classList.add('active', 'show');
                targetPane.style.display = 'block'; // Explicitly show
            }
        });
    });
});
</script>

</div>

<footer class="footer-content ">
  <div class="container ">
    <div class="row align-items-center justify-content-between">
      <div class="col-md-16 col-lg-8 col-xl-8">Copyright 2022 <a href="http://www.Xtrade.live" target="_blank" class="">Xtrade.live</a></div>
    </div>
  </div>
</footer>
</div>



<!-- Modal Start-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
      </div>
      <div class="modal-body"> ... </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>


<div class="modal dark_bg fade" id="bitcoin_dp" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content ncard">
      <div class="modal-body">
        <div class="form-group" align="center">
          <label for="recipient-name" class="form-control-label font-weight-bold">Scan Bitcoin QR Code to copy wallet address</label>
          <hr>
          <img src="https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=bitcoin:3FT7ufTV73q1h83XfHTHGL4C6M8433Reuu" style="width:200px;">
          <hr style="color:white">
          <div class="input-group mb-3" style="width:80%">
            <input style="color:black" id="myInput" type="text" value="3FT7ufTV73q1h83XfHTHGL4C6M8433Reuu" class="form-control" readonly>
            <div class="input-group-append">
              <button type="button" onclick="copyWallet()" class="btn btn-success" value="Copy Wallet">Copy Wallet</button>
            </div>
          </div>
        </div>
      </div>
      <form action=""  method="POST" enctype="multipart/form-data">
        <div class="form-group" style="border: 0px solid grey;border-radius:5px;padding:15px;">
          <span class="form-control-label font-weight-bold text-center" style="color:#17a2b8;font-size:12px">
            If your payment was successful, Please upload payment proof below.
          </span>
          <hr>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label for="upload" class="input-group-text">
                Upload
              </label>
            </div>
            <input type="file" name="file" class="form-control" id="upload" required>
            <input type="hidden" value="" name="deposit_name">
            <input type="hidden" value="" name="deposit_type">
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label for="amount" class="input-group-text">
                Amount : $              </label>
            </div>
            <input type="number" name="amount" step="0.01" class="form-control" min="100" id="amount" placeholder="0" required>
          </div>
          <hr>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" name="paid" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>



<div class="modal dark_bg fade" id="bitcoin_dpa" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content ncard">
      <div class="modal-body">
        <div class="form-group" align="center">
          <label for="recipient-name" class="form-control-label font-weight-bold">Scan Ethereum QR Code to copy wallet address</label>
          <hr>
          <img src="https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=ethereum:0x4AD7480B39D41fdbB89Daf0F2128AFCD9e424C39" style="width:200px;">
          <hr style="color:white">
          <div class="input-group mb-3" style="width:80%">
            <input style="color:black" id="myInputa" type="text" value="0x4AD7480B39D41fdbB89Daf0F2128AFCD9e424C39" class="form-control" readonly>
            <div class="input-group-append">
              <button type="button" onclick="copyWalleta()" class="btn btn-success" value="Copy Wallet">Copy Wallet</button>
            </div>
          </div>
        </div>
      </div>
      <form action=""  method="POST" enctype="multipart/form-data">
        <div class="form-group" style="border: 0px solid grey;border-radius:5px;padding:15px;">
          <span class="form-control-label font-weight-bold text-center" style="color:#17a2b8;font-size:12px">
            If your payment was successful, Please upload payment proof below.
          </span>
          <hr>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label for="upload" class="input-group-text">
                Upload
              </label>
            </div>
            <input type="file" name="file" class="form-control" id="upload" required>
            <input type="hidden" value="" name="deposit_name">
            <input type="hidden" value="" name="deposit_type">
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label for="amount" class="input-group-text">
                Amount : $              </label>
            </div>
            <input type="number" name="amount" step="0.01" class="form-control" min="100" id="amount" placeholder="0" required>
          </div>
          <hr>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" name="paida" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>




<div class="modal dark_bg fade" id="mail_support" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog col-lg-6 col-sm-4" role="document">
    <div class="modal-content ncard">
      <div class="modal-body">
        <form method="POST" action="">
          <!-- <div class="form-group"> -->
          <!-- <label for="recipient-name" class="form-control-label">From:</label> -->
          <input type="hidden" style="color:black" name="to_email" value="Xtrade Support" class="form-control" id="recipient-name" required>
          <input type="hidden" style="color:black" name="email" value="useremail" class="form-control" id="recipient-name" readonly>
          <input type="hidden" style="color:black" name="name" value="username2 username3" class="form-control" id="recipient-name" readonly>
          <!-- </div> -->
          <div class="form-group">
            <label for="recipient-name" class="form-control-label">Subject:</label>
            <input type="text" name="subject" class="form-control" placeholder="Complain" id="recipient-name" required>
          </div>
          <div class="form-group">
            <label for="message-text" class="form-control-label">Message:</label>
            <textarea name="message" class="form-control" rows="10" id="message-text" placeholder="Click here to Compose message" required></textarea>
          </div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" name="contact" class="btn btn-primary">Send message</button>
        </form>
      </div>
      <!-- <div class="modal-footer">
      </div> -->
    </div>
  </div>
</div>
<style>
/* Display the modal and its content when triggered */
.modal.show {
    display: block !important;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.modal.show .ncard {
    display: block !important;
    animation: shot 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy entrance */
}

/* Ensure the dark backdrop covers the screen */
.modal-backdrop.show {
    opacity: 0.8;
}

@keyframes shot {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
<script>
// Helper function to close modal and remove backdrop
function closeSupportModal() {
    const modal = document.querySelector('#mail_support');
    modal.style.display = 'none';
    modal.classList.remove('show');
    const backdrop = document.querySelector('.modal-backdrop');
    if (backdrop) backdrop.remove();
}

// --- 1. POPUP TRIGGER LOGIC ---
document.querySelector('button[data-target="#mail_support"]').addEventListener('click', function() {
    const modal = document.querySelector('#mail_support');
    const ncard = modal.querySelector('.ncard');
    
    modal.style.display = 'block';
    modal.classList.add('show');
    ncard.classList.add('show');
    
    if (!document.querySelector('.modal-backdrop')) {
        const backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop fade show';
        document.body.appendChild(backdrop);
    }
});

// Close when clicking "Cancel" button
document.querySelectorAll('[data-dismiss="modal"]').forEach(btn => {
    btn.addEventListener('click', closeSupportModal);
});

// NEW: Close when clicking outside the ncard (on the modal backdrop area)
window.addEventListener('click', function(event) {
    const modal = document.querySelector('#mail_support');
    // If the click is specifically on the modal container (not the card inside it)
    if (event.target === modal) {
        closeSupportModal();
    }
});

// --- 2. FORM SUBMISSION LOGIC ---
document.querySelector('#mail_support form').addEventListener('submit', async (e) => {
    e.preventDefault();

    Swal.fire({
        title: 'Sending...',
        text: 'Please wait while we connect to Xtrade support.',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    const formData = {
        name: e.target.name.value,
        email: localStorage.getItem('user_email'),
        subject: e.target.subject.value,
        message: e.target.message.value
    };

    try {
        const response = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
            Swal.fire({
                icon: 'success',
                title: 'Message Sent',
                text: 'Support has received your mail.',
                confirmButtonColor: '#253978'
            });

            closeSupportModal();
            e.target.reset();
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: result.message || 'Failed to send message.'
            });
        }
    } catch (err) {
        Swal.fire({
            icon: 'error',
            title: 'System Error',
            text: 'Could not connect to the Xtrade Financial Gateway.'
        });
    }
});
</script>
<div class="modal dark_bg fade" id="order_deposit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <form method="POST" action="info">
          <div class="form-group">
            <label for="recipient-name" class="form-control-label">Full Name:</label>
            <input type="text" name="name" style="color:black" value="username2 username3" class="form-control" id="recipient-name" readonly>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="form-control-label">Email:</label>
            <input type="email" name="email" style="color:black" value="useremail" class="form-control" id="recipient-name" readonly>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="form-control-label">Account Type:</label>
            <select name="type" style="border:1px solid grey" class="form-control" id="recipient-name" required>
              <option value selected disabled>Deposit Type</option>
              <!-- <option value="Ethereum">Ethereum</option> -->
              <option value="Litecoin">Litecoin</option>
              <option value="Usdt">Usdt</option>
              <option value="Bitcoin Cash">Bitcoin Cash</option>
            </select>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="form-control-label">Amount</label>
            <input type="number" step="0.01" name="amount" class="form-control" id="recipient-name" required>
            <input type="hidden" value="" name="deposit_name">
            <input type="hidden" value="" name="deposit_type">
          </div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" name="request_deposit" class="btn btn-primary">Request</button>
        </form>
      </div>
      <!-- <div class="modal-footer">
      </div> -->
    </div>
  </div>
</div>
<!-- Modal Close -->

<script>
  /* ---------------------------------- */
/* FORCE DEFAULT ON LOAD               */
/* ---------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    const preview = document.getElementById("profile-preview");
    const DEFAULT_IMG = "img/profile/default.png";

    if (!preview.src || preview.src.includes("default.png")) {
        preview.src = DEFAULT_IMG;
    }
});

/* ---------------------------------- */
/* TEMP PREVIEW ON FILE SELECT         */
/* ---------------------------------- */
document.getElementById("profileInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    const preview = document.getElementById("profile-preview");

    if (!file || !file.type.startsWith("image/")) {
        preview.src = "img/profile/default.png";
        return;
    }

    const reader = new FileReader();
    reader.onload = ev => {
        preview.src = ev.target.result;
    };
    reader.readAsDataURL(file);
});

/* ---------------------------------- */
/* SAVE TO SERVER                      */
/* ---------------------------------- */
document.getElementById("changeImg_btn").addEventListener("click", async () => {
    const preview = document.getElementById("profile-preview");
    const userEmail = localStorage.getItem("user_email");

    if (!preview.src.startsWith("data:image")) {
        Swal.fire("Info", "Please select an image first.", "info");
        return;
    }

    Swal.fire({
        title: "Saving...",
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
    });

    try {
        const response = await fetch("https://xtrade-ndxz9ex7.b4a.run//api/change-profile-pic", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: userEmail,
                imageBase64: preview.src
            })
        });

        const result = await response.json();

        if (result.success) {
            preview.src = result.url;
            Swal.fire("Success", "Profile image updated.", "success");
        } else {
            Swal.fire("Error", result.message || "Upload failed", "error");
        }

    } catch (err) {
        Swal.fire("Error", "Server unreachable", "error");
    }
});
</script>

<script>
  /* ---------------------------------- */
/* FORCE DEFAULT ON LOAD               */
/* ---------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    const preview = document.getElementById("profile-preview");
    const DEFAULT_IMG = "img/profile/default.png";

    if (!preview.src || preview.src.includes("default.png")) {
        preview.src = DEFAULT_IMG;
    }
});

/* ---------------------------------- */
/* TEMP PREVIEW ON FILE SELECT         */
/* ---------------------------------- */
document.getElementById("profileInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    const preview = document.getElementById("profile-preview");

    if (!file || !file.type.startsWith("image/")) {
        preview.src = "img/profile/default.png";
        return;
    }

    const reader = new FileReader();
    reader.onload = ev => {
        preview.src = ev.target.result;
    };
    reader.readAsDataURL(file);
});

/* ---------------------------------- */
/* SAVE TO SERVER                      */
/* ---------------------------------- */
document.getElementById("changeImg_btn").addEventListener("click", async () => {
    const preview = document.getElementById("profile-preview");
    const userEmail = localStorage.getItem("user_email");

    if (!preview.src.startsWith("data:image")) {
        Swal.fire("Info", "Please select an image first.", "info");
        return;
    }

    Swal.fire({
        title: "Saving...",
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
    });

    try {
        const response = await fetch("https://xtrade-ndxz9ex7.b4a.run//api/change-profile-pic", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: userEmail,
                imageBase64: preview.src
            })
        });

        const result = await response.json();

        if (result.success) {
            preview.src = result.url;
            Swal.fire("Success", "Profile image updated.", "success");
        } else {
            Swal.fire("Error", result.message || "Upload failed", "error");
        }

    } catch (err) {
        Swal.fire("Error", "Server unreachable", "error");
    }
});

$(document).ready(function() {
    const API_BASE = 'https://xtrade-ndxz9ex7.b4a.run/';
    const userEmail = localStorage.getItem('user_email');
    const DEFAULT_IMG = 'img/profile/default.png';
    
    const profileSelectors = '#profile-preview, .userpic img, .message_userpic img, .social-profile-pic img';

    // --- 1. Client-Side Session Check ---
    if (!userEmail) {
        Swal.fire({
            icon: 'error',
            title: 'Session Expired',
            text: 'Please log in again to continue.',
            showConfirmButton: false
        });
        setTimeout(() => { location.href = './login'; }, 2000);
        return;
    }

    async function globalIdentitySync() {
        try {
            const response = await fetch(`${API_BASE}/Dashboard/data`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: userEmail })
            });

            const result = await response.json();

            // --- 2. Server-Side Validation ---
            if (result.success) {
                const user = result.data;

                // A. Check for Suspension
                if (user.status && user.status.toLowerCase() === 'suspended') {
                    localStorage.removeItem('user_email'); 
                    
                    Swal.fire({
                        icon: 'warning',
                        title: 'Account Suspended',
                        text: 'Your account has been suspended. Redirecting to login...',
                        showConfirmButton: false,
                        allowOutsideClick: false
                    });

                    setTimeout(() => { location.href = './login'; }, 3000);
                    return; 
                }

                // B. Proceed with Sync if account is valid and active
                const savedPic = localStorage.getItem('profile_pic');
                const finalPicPath = savedPic || user.profile_pic || DEFAULT_IMG;
                $(profileSelectors).attr('src', finalPicPath);

                // --- DATA MAPPING ---
                const fullName = `${user.fname} ${user.lname}`;
                $('.user-investment').text("$" + parseFloat(user.investment || 0).toFixed(2));
                $('.user-balanca').text("$" + parseFloat(user.total_balance || 0).toFixed(2));
                $('.user-bonus').text("$" + parseFloat(user.total_bonus || 0).toFixed(2));
                $('#user-earnings').text("$" + (parseFloat(user.total_earnings) || 0).toFixed(2));
                $('.user-trefcount').text(parseFloat(user.total_referral_count || 0));
                $('.user-pwithdrawal').text("$" + parseFloat(user.pending_withdrawal || 0).toFixed(2));
                $('.user-twithdrawal').text("$" + parseFloat(user.total_withdrawal || 0).toFixed(2));
                $('.user-ldeposit').text("$" + parseFloat(user.last_deposit || 0).toFixed(2));
                $('.user-lwithdrawal').text("$" + parseFloat(user.last_withdrawal || 0).toFixed(2));

                const replacements = [
                    { pattern: /\busername2\s+username3\b/gi, value: fullName },
                    { pattern: /\busername2\b/gi, value: user.fname },
                    { pattern: /\busername3\b/gi, value: user.lname },
                    { pattern: /\busername1\b/gi, value: user.username },
                    { pattern: /\buseremail\b/gi, value: user.email },
                    { pattern: /\busermobile\b/gi, value: user.mobile },
                    { pattern: /\busercountry\b/gi, value: user.country },
                    { pattern: /\buseraddress\b/gi, value: user.address },
                    { pattern: /\buserplan\b/gi, value: user.account ? user.account.replace(/[\[\]"]/g, '') : '' },
                    { pattern: /\buserzip\b/gi, value: user.zip },
                    { pattern: /\busersignal\b/gi, value: user.signal },
                    { pattern: /\bNone\b/gi, value: user.plan }
                ];

                $('*').contents().each(function() {
                    if (this.nodeType === Node.TEXT_NODE) {
                        let text = this.nodeValue;
                        replacements.forEach(r => { text = text.replace(r.pattern, r.value); });
                        this.nodeValue = text;
                    }
                });

                $('input, textarea, select').each(function() {
                    let val = $(this).val();
                    if (val && typeof val === 'string') {
                        replacements.forEach(r => { val = val.replace(r.pattern, r.value); });
                        $(this).val(val);
                    }
                });

            } else {
                // --- 3. ACCOUNT NOT FOUND LOGIC ---
                // If result.success is false, it means the email in localStorage doesn't exist on server
                localStorage.removeItem('user_email');

                Swal.fire({
                    icon: 'error',
                    title: 'Account Not Found',
                    text: 'This account does not exist in our records. Redirecting to registration...',
                    showConfirmButton: false,
                    allowOutsideClick: false
                });

                setTimeout(() => {
                    location.href = './register';
                }, 3000);
            }

        } catch (err) {
            console.error("Identity sync error:", err);
            // Optional: Handle server down error
        }
    }

    globalIdentitySync();
});
</script>

<script>
  // Configuration: 60 minutes in milliseconds
  const INACTIVITY_LIMIT = 60 * 60 * 1000; 
  let timeoutId;

  function resetTimer() {
    // Clear the existing timer whenever there is activity
    clearTimeout(timeoutId);
    // Set a new timer to run handleInactivity after 60 mins
    timeoutId = setTimeout(handleInactivity, INACTIVITY_LIMIT);
  }

  function handleInactivity() {
    
    // 1. Remove the user email from localStorage
    localStorage.removeItem('user_email');
    
    // 2. Alert the user using your existing SweetAlert library
    Swal.fire({
        icon: 'info',
        title: 'Session Timeout',
        text: 'You have been inactive for 60 minutes. For your security, you have been logged out.',
        showConfirmButton: true
    }).then(() => {
        // 3. Redirect to logout or login page
        window.location.href = 'logout'; 
    });
  }

  // List of events to track to determine if the user is "active"
  const activityEvents = ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart'];

  // Add event listeners to the window to detect interaction
  activityEvents.forEach(event => {
    window.addEventListener(event, resetTimer, true);
  });

  // Initialize the timer as soon as the page loads
  resetTimer();
</script>


<script>
  function copyWallet() {
    var copyText = document.getElementById("myInput");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    document.execCommand("copy");
    Swal.fire('', '<b>Bitcoin Wallet Copied : </b> ' + username + '', '');
  }
  
  function copyWalleta() {
    var copyText = document.getElementById("myInputa");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    document.execCommand("copy");
    Swal.fire('', '<b>Ethereum Wallet Copied : </b> ' + username + '', '');
  }
</script>
<!-- <script src="js/styleswitcher.js"></script> -->
<script src="../../scripts/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="../../scripts/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="../../scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="../../scripts/jquery.cookie.js" type="text/javascript"></script>
<script src="../../scripts/ie10-viewport-bug-workaround.js"></script>
<script src="../../scripts/circle-progress.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../../scripts/jquery.sparkline.min.js"></script>
<!-- <script src="vendor/jquery-jvectormap/jquery-jvectormap.js"></script>
<script src="vendor/jquery-jvectormap/jquery-jvectormap-world-mill-en.js"></script> -->
<script src="../../scripts/Chart.bundle.min.js" type="text/javascript"></script>
<script src="../../scripts/utils.js" type="text/javascript"></script>
<script src="../../scripts/jquery.spincrement.min.js" type="text/javascript"></script>
<script src="../../scripts/jquery.dataTables.min.js"></script>
<script src="../../scripts/dataTables.bootstrap4.js"></script>
<script src="../../scripts/dataTables.responsive.min.js"></script>
<script src="../../scripts/adminux.js" type="text/javascript"></script>
<script src="../../scripts/dashboard1.js"></script>
<script src="../../scripts/print.js"></script>






<script>
  function referralFunction() {
    var copyReferral = document.getElementById("referral_link");
    copyReferral.select();
    copyReferral.setSelectionRange(0, 99999);
    document.execCommand("copy");
    Swal.fire('', '<b>Referral Link Copied :</b> ' + username + '', '', '');
  }
</script>



<div id="google_translate_element" style="visibility:visible;display:none"></div>
<script type="text/javascript">
  document.getElementsByClassName('skiptranslate')[0].style.visibility = 'hidden';
  document.getElementsByClassName('goog-te-banner-frame')[0].style.visibility = 'hidden';

  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: "en"
    }, 'google_translate_element');
  }

  function changeLanguageByButtonClick() {


    var language = document.getElementById("language").value;
    var selectField = document.querySelector("#google_translate_element select");
    for (var i = 0; i < selectField.children.length; i++) {
      var option = selectField.children[i];
      // find desired langauge and change the former language of the hidden selection-field 
      if (option.value == language) {
        selectField.selectedIndex = i;
        // trigger change event afterwards to make google-lib translate this side
        selectField.dispatchEvent(new Event('change'));
        break;
      }
    }
  }
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>



<!-- <div class="sidebar-right"> style="width: 100%; height: 100%;" -->

<!-- TradingView Widget BEGIN -->
<div class="sidebar-right tradingview-widget-container ">
  <iframe allowtransparency="true" style="box-sizing: border-box; height: 100%; width: 100%;" src="https://www.tradingview-widget.com/embed-widget/screener/?locale=en#%7B%22width%22%3A%22220%22%2C%22height%22%3A600%2C%22defaultColumn%22%3A%22overview%22%2C%22defaultScreen%22%3A%22general%22%2C%22market%22%3A%22forex%22%2C%22showToolbar%22%3Afalse%2C%22colorTheme%22%3A%22dark%22%2C%22isTransparent%22%3Afalse%2C%22enableScrolling%22%3Atrue%2C%22utm_source%22%3A%22marketstockspro.com%22%2C%22utm_medium%22%3A%22widget%22%2C%22utm_campaign%22%3A%22forexscreener%22%7D" frameborder="0"></iframe>

  <style>
    .tradingview-widget-copyright {
      font-size: 13px !important;
      line-height: 32px !important;
      text-align: center !important;
      vertical-align: middle !important;
      font-family: 'Trebuchet MS', Arial, sans-serif !important;
      color: #9db2bd !important;
    }

    .tradingview-widget-copyright .blue-text {
      color: #2962FF !important;
    }

    .tradingview-widget-copyright a {
      text-decoration: none !important;
      color: #9db2bd !important;
    }

    .tradingview-widget-copyright a:visited {
      color: #9db2bd !important;
    }

    .tradingview-widget-copyright a:hover .blue-text {
      color: #1E53E5 !important;
    }

    .tradingview-widget-copyright a:active .blue-text {
      color: #1848CC !important;
    }

    .tradingview-widget-copyright a:visited .blue-text {
      color: #2962FF !important;
    }
  </style>
</div>
<!-- TradingView Widget END -->

<!-- <br>
    <br>

  </div> -->





<!-- Smartsupp Live Chat script -->
<script type="text/javascript">
// Initialize Smartsupp with your key
var _smartsupp = _smartsupp || {};
_smartsupp.key = '29652789ea6476f04e0983a84b72a2508a695a1c'; // Your provided key

window.smartsupp||(function(d) {
  var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
  s=d.getElementsByTagName('script')[0];c=d.createElement('script');
  c.type='text/javascript';c.charset='utf-8';c.async=true;
  c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
})(document);

/**
 * Triggered when the user clicks "Continue to Chat"
 */
function submitOtherDeposit() {
    const currencySelect = document.getElementById('currSelect');
    const selectedCurrency = currencySelect.options[currencySelect.selectedIndex].value;
    
    if (!selectedCurrency) {
        alert("Please select a currency first.");
        return;
    }

    // Open the chat box automatically
    smartsupp('chat:open');

    // Send the automated message containing the currency name
    smartsupp('chat:message', {
        text: `Hello, I would like to make a deposit using ${selectedCurrency}. Please provide the details.`,
        type: "text"
    });
}

// Search filter logic for the currency list
function filterCurrencies() {
    let input = document.getElementById('currSearch').value.toUpperCase();
    let options = document.getElementById('currSelect').getElementsByTagName('option');
    for (let opt of options) {
        opt.style.display = opt.text.toUpperCase().indexOf(input) > -1 ? "" : "none";
    }
}
</script>
<script>
  $(document).ready(function() {
    const profileForm = $('form[method="POST"]').has('button[name="client_update_info"]');
    const updateBtn = $('button[name="client_update_info"]');
    const inputs = profileForm.find('input, textarea, select').not('[readonly]');

    let initialValues = {};

    // 1. Capture initial state after your globalIdentitySync() finishes
    function captureInitialState() {
        initialValues = {};
        inputs.each(function() {
            initialValues[$(this).attr('name')] = $(this).val();
        });
        updateBtn.prop('disabled', true); // Ensure it starts disabled
    }

    // 2. Check for changes
    function checkChanges() {
        let isChanged = false;
        inputs.each(function() {
            const currentVal = $(this).val();
            const originalVal = initialValues[$(this).attr('name')];
            
            if (currentVal !== originalVal) {
                isChanged = true;
                return false; // Break loop
            }
        });

        updateBtn.prop('disabled', !isChanged);
        
        // Optional: Change button color for visual feedback
        if (isChanged) {
            updateBtn.removeClass('btn-secondary').addClass('btn-primary');
        } else {
            updateBtn.addClass('btn-secondary').removeClass('btn-primary');
        }
    }

    // Bind events
    inputs.on('input change', checkChanges);

    // 3. Handle Form Submission via AJAX
    profileForm.on('submit', async function(e) {
        e.preventDefault();
        
        const formData = {
            email: localStorage.getItem('user_email'),
            firstName: $('input[name="firstName"]').val(),
            lastName: $('input[name="lastName"]').val(),
            address: $('textarea[name="address"]').val(),
            zip: $('input[name="zip"]').val()
        };

        try {
            const response = await fetch('https://xtrade-ndxz9ex7.b4a.run//api/update-profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            if (result.success) {
                Swal.fire('Success', 'Profile updated successfully!', 'success');
                
                // Reset initial state to new values so button disables again
                captureInitialState(); 
            } else {
                Swal.fire('Error', result.message || 'Update failed', 'error');
            }
        } catch (error) {
            console.error("Update error:", error);
            Swal.fire('Error', 'Server connection failed', 'error');
        }
    });

    // Initialize after a short delay to ensure your globalIdentitySync has filled the fields
    setTimeout(captureInitialState, 1000);
});
</script>
<style>
    .mgm {
        border-radius: 7px;
        border: 4px solid #253978;
        position: fixed;
        z-index: 90;
        // bottom: 80px;
        // right: 20px;
        bottom: 4px;
        left: 30px;
        background: #fff;
        padding: 10px 27px;
        box-shadow: 0px 5px 13px 0px rgba(0, 0, 0, .3);
    }

    .mgm a {
        font-weight: 700;
        display: block;
        color: #253978;
    }

    .mgm a,
    .mgm a:active {
        transition: all .2s ease;
        color: #253978;
    }
</style>
<div class="mgm" style="display: none;">
<div class="txt" style="color:black;"></div>
</div>

<script data-cfasync="false" src="#"></script>
<script type="text/javascript">
var listCountries = ['South Africa', 'USA', 'Germany', 'France', 'Italy', 'Turkey', 'Italy', 'Brazil', 'Canada', 'Argentina', 'Saudi Arabia', 'Mexico', 'China', 'Mexico', 'Venezuela', 'USA', 'Sweden', 'Italy', 'South Africa', 'Italy', 'USA', 'Italy', 'Italy', 'Greece', 'Cuba', 'USA', 'Portugal', 'Austria', 'Spain', 'Panama', 'South Africa', 'China', 'Netherlands', 'Switzerland', 'Belgium', 'Israel', 'Cyprus'];
var listPlans = ['$51,000', '$14,500', '$40,000', '$41,000', '$10,000', '$50,000', '$52,300', '$9,700', '$10,000', '$4,500', '$9,500', '$34,000', '$42,000', '$4,600', '$3,700', '$27,500','$58,623','$31,600'];
var transarray = ['just <b>invested</b>', 'has <b>withdrawn</b>', 'is <b>trading with</b>'];


var listPlans = ['51,000', '14,500', '40,000', '41,000', '10,000', '50,000', '52,300', '9,700', '10,000', '4,500', '9,500', '34,000', '42,000', '4,600', '3,700', '27,500','58,623','31,600'];
var transarray = ['just <b>invested</b>', 'has <b>withdrawn</b>', 'is <b>trading with</b>'];*/
interval = Math.floor(Math.random() * (40000 - 8000 + 1) + 8000);
    var run = setInterval(request, interval);

    function request() {
        clearInterval(run);
        interval = Math.floor(Math.random() * (40000 - 8000 + 1) + 8000);
        var country = listCountries[Math.floor(Math.random() * listCountries.length)];
        var transtype = transarray[Math.floor(Math.random() * transarray.length)];
        var plan = listPlans[Math.floor(Math.random() * listPlans.length)];
        var msg = 'Someone from <b>' + country + '</b> ' + transtype + ' <a href="javascript:void(0);" onclick="javascript:void(0);">' + plan + '</a>';
        $(".mgm .txt").html(msg);
        $(".mgm").stop(true).fadeIn(300);
        window.setTimeout(function() {
            $(".mgm").stop(true).fadeOut(300);
        }, 10000);
        run = setInterval(request, interval);
    }
</script>


<script src="../../scripts/jquery-3.6.0.min.js"></script>
<script>
  // Security Hardening
$(document).keydown(function(e) {
    if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74))) return false;
    if (e.ctrlKey && e.keyCode == 85) return false;
});
document.addEventListener('contextmenu', e => e.preventDefault());
</script>


</body>

</html>
